{"ast":null,"code":"import { error, doneInvoke } from './actions.js';\nimport { toActorRef } from './Actor.js';\nimport { toObserver } from './utils.js';\n/**\r\n * Returns an actor behavior from a reducer and its initial state.\r\n *\r\n * @param transition The pure reducer that returns the next state given the current state and event.\r\n * @param initialState The initial state of the reducer.\r\n * @returns An actor behavior\r\n */\n\nfunction fromReducer(transition, initialState) {\n  return {\n    transition: transition,\n    initialState: initialState\n  };\n}\n\nfunction fromPromise(promiseFn) {\n  var initialState = {\n    error: undefined,\n    data: undefined,\n    status: 'pending'\n  };\n  return {\n    transition: function transition(state, event, _a) {\n      var parent = _a.parent,\n          id = _a.id,\n          observers = _a.observers;\n\n      switch (event.type) {\n        case 'fulfill':\n          parent === null || parent === void 0 ? void 0 : parent.send(doneInvoke(id, event.data));\n          return {\n            error: undefined,\n            data: event.data,\n            status: 'fulfilled'\n          };\n\n        case 'reject':\n          parent === null || parent === void 0 ? void 0 : parent.send(error(id, event.error));\n          observers.forEach(function (observer) {\n            observer.error(event.error);\n          });\n          return {\n            error: event.error,\n            data: undefined,\n            status: 'rejected'\n          };\n\n        default:\n          return state;\n      }\n    },\n    initialState: initialState,\n    start: function start(_a) {\n      var self = _a.self;\n      promiseFn().then(function (data) {\n        self.send({\n          type: 'fulfill',\n          data: data\n        });\n      }, function (reason) {\n        self.send({\n          type: 'reject',\n          error: reason\n        });\n      });\n      return initialState;\n    }\n  };\n}\n\nfunction spawnBehavior(behavior, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var state = behavior.initialState;\n  var observers = new Set();\n  var mailbox = [];\n  var flushing = false;\n\n  var flush = function flush() {\n    if (flushing) {\n      return;\n    }\n\n    flushing = true;\n\n    while (mailbox.length > 0) {\n      var event_1 = mailbox.shift();\n      state = behavior.transition(state, event_1, actorCtx);\n      observers.forEach(function (observer) {\n        return observer.next(state);\n      });\n    }\n\n    flushing = false;\n  };\n\n  var actor = toActorRef({\n    id: options.id,\n    send: function send(event) {\n      mailbox.push(event);\n      flush();\n    },\n    getSnapshot: function getSnapshot() {\n      return state;\n    },\n    subscribe: function subscribe(next, handleError, complete) {\n      var observer = toObserver(next, handleError, complete);\n      observers.add(observer);\n      observer.next(state);\n      return {\n        unsubscribe: function unsubscribe() {\n          observers.delete(observer);\n        }\n      };\n    }\n  });\n  var actorCtx = {\n    parent: options.parent,\n    self: actor,\n    id: options.id || 'anonymous',\n    observers: observers\n  };\n  state = behavior.start ? behavior.start(actorCtx) : state;\n  return actor;\n}\n\nexport { fromPromise, fromReducer, spawnBehavior };","map":{"version":3,"names":["error","doneInvoke","toActorRef","toObserver","fromReducer","transition","initialState","fromPromise","promiseFn","undefined","data","status","state","event","_a","parent","id","observers","type","send","forEach","observer","start","self","then","reason","spawnBehavior","behavior","options","Set","mailbox","flushing","flush","length","event_1","shift","actorCtx","next","actor","push","getSnapshot","subscribe","handleError","complete","add","unsubscribe","delete"],"sources":["/project/xstate-getting-started/node_modules/xstate/es/behaviors.js"],"sourcesContent":["import { error, doneInvoke } from './actions.js';\nimport { toActorRef } from './Actor.js';\nimport { toObserver } from './utils.js';\n\n/**\r\n * Returns an actor behavior from a reducer and its initial state.\r\n *\r\n * @param transition The pure reducer that returns the next state given the current state and event.\r\n * @param initialState The initial state of the reducer.\r\n * @returns An actor behavior\r\n */\n\nfunction fromReducer(transition, initialState) {\n  return {\n    transition: transition,\n    initialState: initialState\n  };\n}\nfunction fromPromise(promiseFn) {\n  var initialState = {\n    error: undefined,\n    data: undefined,\n    status: 'pending'\n  };\n  return {\n    transition: function (state, event, _a) {\n      var parent = _a.parent,\n          id = _a.id,\n          observers = _a.observers;\n\n      switch (event.type) {\n        case 'fulfill':\n          parent === null || parent === void 0 ? void 0 : parent.send(doneInvoke(id, event.data));\n          return {\n            error: undefined,\n            data: event.data,\n            status: 'fulfilled'\n          };\n\n        case 'reject':\n          parent === null || parent === void 0 ? void 0 : parent.send(error(id, event.error));\n          observers.forEach(function (observer) {\n            observer.error(event.error);\n          });\n          return {\n            error: event.error,\n            data: undefined,\n            status: 'rejected'\n          };\n\n        default:\n          return state;\n      }\n    },\n    initialState: initialState,\n    start: function (_a) {\n      var self = _a.self;\n      promiseFn().then(function (data) {\n        self.send({\n          type: 'fulfill',\n          data: data\n        });\n      }, function (reason) {\n        self.send({\n          type: 'reject',\n          error: reason\n        });\n      });\n      return initialState;\n    }\n  };\n}\nfunction spawnBehavior(behavior, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var state = behavior.initialState;\n  var observers = new Set();\n  var mailbox = [];\n  var flushing = false;\n\n  var flush = function () {\n    if (flushing) {\n      return;\n    }\n\n    flushing = true;\n\n    while (mailbox.length > 0) {\n      var event_1 = mailbox.shift();\n      state = behavior.transition(state, event_1, actorCtx);\n      observers.forEach(function (observer) {\n        return observer.next(state);\n      });\n    }\n\n    flushing = false;\n  };\n\n  var actor = toActorRef({\n    id: options.id,\n    send: function (event) {\n      mailbox.push(event);\n      flush();\n    },\n    getSnapshot: function () {\n      return state;\n    },\n    subscribe: function (next, handleError, complete) {\n      var observer = toObserver(next, handleError, complete);\n      observers.add(observer);\n      observer.next(state);\n      return {\n        unsubscribe: function () {\n          observers.delete(observer);\n        }\n      };\n    }\n  });\n  var actorCtx = {\n    parent: options.parent,\n    self: actor,\n    id: options.id || 'anonymous',\n    observers: observers\n  };\n  state = behavior.start ? behavior.start(actorCtx) : state;\n  return actor;\n}\n\nexport { fromPromise, fromReducer, spawnBehavior };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}