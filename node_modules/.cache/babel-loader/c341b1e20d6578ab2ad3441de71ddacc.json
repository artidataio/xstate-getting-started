{"ast":null,"code":"import { useRef, useCallback } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport useConstant from './useConstant';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\nexport function isActorWithState(actorRef) {\n  return 'state' in actorRef;\n}\n\nfunction isDeferredActor(actorRef) {\n  return 'deferred' in actorRef;\n}\n\nfunction defaultGetSnapshot(actorRef) {\n  return 'getSnapshot' in actorRef ? actorRef.getSnapshot() : isActorWithState(actorRef) ? actorRef.state : undefined;\n}\n\nexport function useActor(actorRef, getSnapshot) {\n  if (getSnapshot === void 0) {\n    getSnapshot = defaultGetSnapshot;\n  }\n\n  var actorRefRef = useRef(actorRef);\n  var deferredEventsRef = useRef([]);\n  var subscribe = useCallback(function (handleStoreChange) {\n    var unsubscribe = actorRef.subscribe(handleStoreChange).unsubscribe;\n    return unsubscribe;\n  }, [actorRef]);\n  var boundGetSnapshot = useCallback(function () {\n    return getSnapshot(actorRef);\n  }, [actorRef, getSnapshot]);\n  var storeSnapshot = useSyncExternalStore(subscribe, boundGetSnapshot, boundGetSnapshot);\n  var send = useConstant(function () {\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var event = args[0];\n\n      if (process.env.NODE_ENV !== 'production' && args.length > 1) {\n        console.warn(\"Unexpected payload: \".concat(JSON.stringify(args[1]), \". Only a single event object can be sent to actor send() functions.\"));\n      }\n\n      var currentActorRef = actorRefRef.current; // If the previous actor is a deferred actor,\n      // queue the events so that they can be replayed\n      // on the non-deferred actor.\n\n      if (isDeferredActor(currentActorRef) && currentActorRef.deferred) {\n        deferredEventsRef.current.push(event);\n      } else {\n        currentActorRef.send(event);\n      }\n    };\n  });\n  useIsomorphicLayoutEffect(function () {\n    actorRefRef.current = actorRef; // Dequeue deferred events from the previous deferred actorRef\n\n    while (deferredEventsRef.current.length > 0) {\n      var deferredEvent = deferredEventsRef.current.shift();\n      actorRef.send(deferredEvent);\n    }\n  }, [actorRef]);\n  return [storeSnapshot, send];\n}","map":{"version":3,"names":["useRef","useCallback","useIsomorphicLayoutEffect","useConstant","useSyncExternalStore","isActorWithState","actorRef","isDeferredActor","defaultGetSnapshot","getSnapshot","state","undefined","useActor","actorRefRef","deferredEventsRef","subscribe","handleStoreChange","unsubscribe","boundGetSnapshot","storeSnapshot","send","args","_i","arguments","length","event","process","env","NODE_ENV","console","warn","concat","JSON","stringify","currentActorRef","current","deferred","push","deferredEvent","shift"],"sources":["/project/xstate-getting-started/node_modules/@xstate/react/es/useActor.js"],"sourcesContent":["import { useRef, useCallback } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport useConstant from './useConstant';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\nexport function isActorWithState(actorRef) {\n    return 'state' in actorRef;\n}\nfunction isDeferredActor(actorRef) {\n    return 'deferred' in actorRef;\n}\nfunction defaultGetSnapshot(actorRef) {\n    return 'getSnapshot' in actorRef\n        ? actorRef.getSnapshot()\n        : isActorWithState(actorRef)\n            ? actorRef.state\n            : undefined;\n}\nexport function useActor(actorRef, getSnapshot) {\n    if (getSnapshot === void 0) { getSnapshot = defaultGetSnapshot; }\n    var actorRefRef = useRef(actorRef);\n    var deferredEventsRef = useRef([]);\n    var subscribe = useCallback(function (handleStoreChange) {\n        var unsubscribe = actorRef.subscribe(handleStoreChange).unsubscribe;\n        return unsubscribe;\n    }, [actorRef]);\n    var boundGetSnapshot = useCallback(function () { return getSnapshot(actorRef); }, [\n        actorRef,\n        getSnapshot\n    ]);\n    var storeSnapshot = useSyncExternalStore(subscribe, boundGetSnapshot, boundGetSnapshot);\n    var send = useConstant(function () { return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var event = args[0];\n        if (process.env.NODE_ENV !== 'production' && args.length > 1) {\n            console.warn(\"Unexpected payload: \".concat(JSON.stringify(args[1]), \". Only a single event object can be sent to actor send() functions.\"));\n        }\n        var currentActorRef = actorRefRef.current;\n        // If the previous actor is a deferred actor,\n        // queue the events so that they can be replayed\n        // on the non-deferred actor.\n        if (isDeferredActor(currentActorRef) && currentActorRef.deferred) {\n            deferredEventsRef.current.push(event);\n        }\n        else {\n            currentActorRef.send(event);\n        }\n    }; });\n    useIsomorphicLayoutEffect(function () {\n        actorRefRef.current = actorRef;\n        // Dequeue deferred events from the previous deferred actorRef\n        while (deferredEventsRef.current.length > 0) {\n            var deferredEvent = deferredEventsRef.current.shift();\n            actorRef.send(deferredEvent);\n        }\n    }, [actorRef]);\n    return [storeSnapshot, send];\n}\n"],"mappings":"AAAA,SAASA,MAAT,EAAiBC,WAAjB,QAAoC,OAApC;AACA,OAAOC,yBAAP,MAAsC,8BAAtC;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,SAASC,oBAAT,QAAqC,8BAArC;AACA,OAAO,SAASC,gBAAT,CAA0BC,QAA1B,EAAoC;EACvC,OAAO,WAAWA,QAAlB;AACH;;AACD,SAASC,eAAT,CAAyBD,QAAzB,EAAmC;EAC/B,OAAO,cAAcA,QAArB;AACH;;AACD,SAASE,kBAAT,CAA4BF,QAA5B,EAAsC;EAClC,OAAO,iBAAiBA,QAAjB,GACDA,QAAQ,CAACG,WAAT,EADC,GAEDJ,gBAAgB,CAACC,QAAD,CAAhB,GACIA,QAAQ,CAACI,KADb,GAEIC,SAJV;AAKH;;AACD,OAAO,SAASC,QAAT,CAAkBN,QAAlB,EAA4BG,WAA5B,EAAyC;EAC5C,IAAIA,WAAW,KAAK,KAAK,CAAzB,EAA4B;IAAEA,WAAW,GAAGD,kBAAd;EAAmC;;EACjE,IAAIK,WAAW,GAAGb,MAAM,CAACM,QAAD,CAAxB;EACA,IAAIQ,iBAAiB,GAAGd,MAAM,CAAC,EAAD,CAA9B;EACA,IAAIe,SAAS,GAAGd,WAAW,CAAC,UAAUe,iBAAV,EAA6B;IACrD,IAAIC,WAAW,GAAGX,QAAQ,CAACS,SAAT,CAAmBC,iBAAnB,EAAsCC,WAAxD;IACA,OAAOA,WAAP;EACH,CAH0B,EAGxB,CAACX,QAAD,CAHwB,CAA3B;EAIA,IAAIY,gBAAgB,GAAGjB,WAAW,CAAC,YAAY;IAAE,OAAOQ,WAAW,CAACH,QAAD,CAAlB;EAA+B,CAA9C,EAAgD,CAC9EA,QAD8E,EAE9EG,WAF8E,CAAhD,CAAlC;EAIA,IAAIU,aAAa,GAAGf,oBAAoB,CAACW,SAAD,EAAYG,gBAAZ,EAA8BA,gBAA9B,CAAxC;EACA,IAAIE,IAAI,GAAGjB,WAAW,CAAC,YAAY;IAAE,OAAO,YAAY;MACpD,IAAIkB,IAAI,GAAG,EAAX;;MACA,KAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;QAC1CD,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;MACH;;MACD,IAAIG,KAAK,GAAGJ,IAAI,CAAC,CAAD,CAAhB;;MACA,IAAIK,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,IAAyCP,IAAI,CAACG,MAAL,GAAc,CAA3D,EAA8D;QAC1DK,OAAO,CAACC,IAAR,CAAa,uBAAuBC,MAAvB,CAA8BC,IAAI,CAACC,SAAL,CAAeZ,IAAI,CAAC,CAAD,CAAnB,CAA9B,EAAuD,qEAAvD,CAAb;MACH;;MACD,IAAIa,eAAe,GAAGrB,WAAW,CAACsB,OAAlC,CAToD,CAUpD;MACA;MACA;;MACA,IAAI5B,eAAe,CAAC2B,eAAD,CAAf,IAAoCA,eAAe,CAACE,QAAxD,EAAkE;QAC9DtB,iBAAiB,CAACqB,OAAlB,CAA0BE,IAA1B,CAA+BZ,KAA/B;MACH,CAFD,MAGK;QACDS,eAAe,CAACd,IAAhB,CAAqBK,KAArB;MACH;IACJ,CAnBoC;EAmBjC,CAnBkB,CAAtB;EAoBAvB,yBAAyB,CAAC,YAAY;IAClCW,WAAW,CAACsB,OAAZ,GAAsB7B,QAAtB,CADkC,CAElC;;IACA,OAAOQ,iBAAiB,CAACqB,OAAlB,CAA0BX,MAA1B,GAAmC,CAA1C,EAA6C;MACzC,IAAIc,aAAa,GAAGxB,iBAAiB,CAACqB,OAAlB,CAA0BI,KAA1B,EAApB;MACAjC,QAAQ,CAACc,IAAT,CAAckB,aAAd;IACH;EACJ,CAPwB,EAOtB,CAAChC,QAAD,CAPsB,CAAzB;EAQA,OAAO,CAACa,aAAD,EAAgBC,IAAhB,CAAP;AACH"},"metadata":{},"sourceType":"module"}